<svelte:head>
  <title>Ross Hill - Website and Portfolio</title>
</svelte:head>
<Header/>
<PostControls/>
<Posts posts={posts}/>
<script>
  export default {
    components: {
      Header: "../components/Header.html",
      Posts: "../components/Posts.html",
      PostControls: "../components/PostControls.html"
    },
    preload({ params, query }) {
      const sort = query.sort || "new";
      const searchString = query.searchString || "";

      const shuffle = arr => {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
      };

      const compare = (a, b) => {
        switch (sort.toLowerCase()) {
          case "alpha": {
            if (a.title < b.title) return -1;
            if (a.title > b.title) return 1;
            else return 0;
          }
          case "revalpha": {
            if (a.title > b.title) return -1;
            if (a.title < b.title) return 1;
            else return 0;
          }
          case "old": {
            return new Date(a.date) - new Date(b.date);
          }
          default: {
            // new
            return new Date(b.date) - new Date(a.date);
          }
        }
      };

      return this.fetch(`index.json?searchString=${searchString}`)
        .then(r => r.json())
        .then(posts => {
          if (sort === "shuffle") shuffle(posts);
          else posts.sort((a, b) => compare(a, b));
          return { posts };
        });
    }
  };
</script>
