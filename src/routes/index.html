<svelte:head>
  <title>Ross Hill - Website and Portfolio</title>
</svelte:head>
<Header/>
<PostControls bind:sort bind:searchString/>
<Posts posts={posts}/>
<script>
  export default {
    components: {
      Header: "../components/Header.html",
      Posts: "../components/Posts.html",
      PostControls: "../components/PostControls.html"
    },
    data() {
			return {
        sort: "new",
        searchString: ""
			};
    },
    onstate({ changed, current, previous }) {
			if (changed.sort || changed.searchString) {
        console.log(`sort changed: ${previous && previous.sort} -> ${current.sort}`);
        this.fetch(`index.json?sort=${current.sort}&searchString=${current.searchString}`)
          .then(r => r.json())
          .then(posts => {
            this.set({ posts });
          });
			}
		},
    preload(data) {
      const sort = data.query.sort || "new";
      const searchString = data.query.searchString || "";

      return this.fetch(`index.json?sort=${sort}&searchString=${searchString}`)
        .then(r => r.json())
        .then(posts => {
          return { posts };
        });
    }
  };
</script>
